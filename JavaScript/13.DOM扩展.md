# DOM扩展

## `Selectors API`

### `querySelector()`

接受一个`css`选择符参数，返回匹配该模式的第一个后代元素，如果没有匹配的则返回null，可在`Document`,`DocumentFragment`和`Element`类型上使用

```js
let myDiv = document.querySelector('#myDiv')

let body = document.querySelector('body')

let img = document.querySelector('img.button')
```

### `querySelectorAll()`

接收一个`css`选择符参数，返回所有匹配的节点。这个方法返回的时一个`NodeList`静态实例。可在`Document`,`DocumentFragment`和`Element`类型上使用

### `matches()`

接收一个`css`选择符参数，如果元素匹配则该选择符返回true

IE即移动浏览器需要带前缀

## 元素遍历

`IE9`以前不会把元素间的空格当成空白节点，而其他浏览器会，这就导致了`firstChild`等属性有差异，为了解决这种差异，新增了`Element Traversal API`

- `childElementCount`返回子元素数量(不包含文本节点和注释)
- `firstElementChild`指向第一个`Element`类型的子元素
- `lastElementChild`指向最后一个`Element`类型的子元素
- `previousElementSibling`指向前一个`Element`类型的同胞节点
- `nextElementSibling`指向后一个`Element`类型的同胞节点

## `HTML5`新增

### `CSS`类扩展

#### `getElementByClassName()`

`getElementByClassName()`接收一个参数（包含一个或多个类名的字符串），返回类名中匹配的元素的`NodeList`

```js
// 取得所有类名中包含username和current的元素
let allCurrentUsernames = document.getElementByClassName('username current')
```

#### `classList`属性

`HTML5`会给所有元素增加`classList`属性，`classList`属性是一个新的集合类型`DOMTokenList`的实例，可通过length查看长度，通过`item()`或中括号取得个别元素

操作方法：

- `add(value)`：向类名列表中添加指定的类型
- `contains(value)`：返回布尔值，表示给定的value是否存在
- `remove(value)`：从类名列表中删除指定的字符串值value
- `toggle(value)`：如果类名列表中已存在指定的value，则删除，反之添加

### 焦点管理

`document.activeElement`包含当前拥有焦点的DOM元素，用户可通过tab键或focus方法让某个元素自动获取焦点

页面加载完成之后，默认值为`document.body`

`document.hasFocus()`可检测文档是否拥有焦点

### `HTMLDocument`扩展

#### `readyState`属性

`document.readyState`属性有两个可能的值：

- loading：表示文档正在加载
- complete：表示文档加载完成

```js
if(document.readyState=='complete'){
	// 执行操作
}
```

#### `compatMode`属性

`document.compatMode`属性指示文档处于什么模式，`CSS1Compat`为标准模式，`BackCompat`为混杂模式

```js
if (document.compatMode == "CSS1Compat"){
  console.log("Standards mode");
} else {
  console.log("Quirks mode");
}
```

#### head属性

`document.head`指向head元素

### 字符集属性

`document.characterSet`属性表示文档实际使用的字符集，默认为`'UTF-16'`

```js
console.log(document.characterSet) // utf-16
document.characterSet = 'UTF-8'
```

### 自定义数据属性

`html5`用`data-`开头指定自定义属性。定义了自定义数据属性后，可通过元素的`dataset`属性来访问。`dataset`属性是一个`DOMStringMap`的实例，包含一组键值对映射。

`data-my-name`要通过`myName`来访问

```js
let div = document.getElementById("myDiv")

// 取得自定义数据属性的值
let appId = div.dataset.appId
let myName = div.dataset.myname
```

### 插入标记

#### `innerHTML`属性

读取`innerHTML`属性会返回元素所有后代`HTML`字符串，包括元素、注释和文本节点。写入`innerHTML`时会根据字符串值以新的DOM子树代替元素中原来包含的所有节点

IE和Opera的返回值会把元素标签转为大写，Safari、chrome和Firefox会按照文档源代码的格式返回

#### `outerHTML`属性

读取`outerHTML`属性会返回调用它的元素（及所有后代元素）的HTML字符串。在写入`outerHTML`属性时，调用它的元素会被传入的HTML字符串生成的DOM子树取代

#### `insertAdjacentHTML()`和`insertAdjacentText()`

